<!DOCTYPE html>
<html>
  <head>
    <title>COUNT¬∑ME¬∑IN</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/sequencer.css">
    <link rel="stylesheet" href="css/track.css">
    <style>



      #xy-pad {
          display: none;
          height: 30vw;
          width: 30vw;
          border: 5px solid black;
          background-color: lightgray;
      }

      table#emojis {
          margin-top: 10px;
          margin-left: 10px;
          border-collapse: collapse;
      }

      td.emoji {
          padding: 10px;
      }   

      .emoji {
          display: block;
          height: 15vw;
          width: 15vw;
          background-color: rgb(176, 201, 255);
          font-size: 10vw;
          text-align: center;
          line-height: 15vw;
          filter: grayscale(100%);
          border-radius: 1vw;
          user-select: none;
      }

      .emoji:active {
          filter:grayscale(0%);
      }

      .selected {
          filter:grayscale(0%);
      }

  </style>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5JXMQXE0QJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-5JXMQXE0QJ');
    </script>
  </head>
  <body>

    <div id="paused">
      <div>
        <img id="instrument-icon-paused" /><br />
        <span class="translate" id="lang-hello">Hello</span> <span id="small-initials"></span>!<br />
        <span class="translate" id="lang-paused">The session will start in a bit.</span>
      </div>
      <div class="rotate-me">
        <img src="images/rotatephone.gif" alt="Please rotate your device" />
      </div>
    </div>
    

    <div id="sequencer">

        <div id="track-header">

          <div id="icon-initials">
            <div id="instrument">
              <img id="big-instrument-icon" />
            </div>
            <div id="big-initials"></div>
          </div>

          <div id="expert-controls">
            <label for="expert-mode" class="translate" id="lang-expert-label">Expert mode:</label>
            <input type="checkbox" id="expert-mode" />
          </div>

          <div id="empty">
            <div id="control-panel">
              <div id="remaining-rounds"><span class="translate" id="lang-rounds">Remaining rounds</span>: <span id="counter">?</span></div>
            </div>
          </div>

        </div>

        <table id="matrix">
        </table>

        <input type="text" id="prompt" placeholder="Enter your prompt" />
        <button onclick="sendData()">Click Here</button>
        <div onmouseover="xyMove()" id="xy-pad">
        </div>
        <table id="emojis">
            <tr>
                <td><div class="emoji" v="-1" a="1">üò©</div></td>
                <td><div class="emoji" v="1" a="1">ü§©</div></td>
            </tr>
            <tr>
                <td><div class="emoji" v="-1" a="-1">üôÅ</div></td>
                <td><div class="emoji" v="1" a="-1">üôÇ</div></td>
            </tr>
        </table>
        
        <button id="restart" class="ui-button"
        style="display:none"
        ><span class="translate" id="lang-exit">Exit</span></button>


        <div class="rotate-me">
          <img src="images/rotatephone.gif" alt="Please rotate your device" />
        </div>
    </div>
    <!-- <script src="scripts/NoSleep.js"></script> -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="scripts/config.js"></script>
    <script src="scripts/include.js"></script>
    <script src="scripts/sessionObj.js"></script>
    <script src="scripts/sequencer.js"></script>
    <script src="scripts/track.js"></script>
    <script>
          var emojis = document.querySelectorAll('.emoji');

          emojis.forEach(emoji => {
              emoji.addEventListener('mousedown', function(){
                  emojis.forEach(emoji => {
                      emoji.classList.remove('selected');
                  });
                  const v = emoji.getAttribute('v');
                  const a = emoji.getAttribute('a');
                  const data = {'v': v, 'a': a};
                  //sendMsg('emotion', data);
                  fetch('https://raw.githubusercontent.com/jpcarrascal/count-me-in/refs/heads/main/experiments/data.txt')
                    .then(response => response.text())
                    .then(data => {console.log(data)
                      emoji.classList.add('selected');
                      var newNotes = randomizeNotes(myNotes);
                      var track = myTrack;
                      socket.emit('update all track notes', { track: track, socketid: mySocketID, notes: newNotes } );
                    })
                    .catch(error => console.error('Error:', error));
                  });
          });

          function randomizeNotes(notes) {
              for(var i=0; i<notes.length; i++) {
                if(Math.random() > 0.5) {
                  notes[i].note = Math.floor(Math.random() * 80) + 20;
                }
                if(Math.random() > 0.5) notes[i].vel = 100;
                  else notes[i].vel = -1;
              }
              return notes;
          }
          
          function updateNotes(notes, array) {
              for(var i=0; i<notes.length; i++) {
                if(array[i] > 0) {
                  notes[i].note = array[i];
                  notes[i].vel = 100;
                } else {
                  notes[i].note = 0;
                  notes[i].vel = -1;
                }
              }
              return notes;
          }
          
    </script>

  </body>
</html>